<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Genius Academy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    :root{ --accent-teal:#00BFA5; --primary-blue:#0A3D62 }
    body{ font-family:'Inter',sans-serif }
    .bg-hero{ background:linear-gradient(135deg,#0A3D62 0%,#176B87 100%) }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <a href="index.html" class="flex items-center text-xl font-extrabold text-blue-800 tracking-tight">
        <i class="fas fa-brain text-2xl mr-2 text-[var(--accent-teal)]"></i> Genius Academy
      </a>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-grow flex items-center justify-center py-12 px-4">
    <div class="max-w-md w-full">
      <!-- Tabs -->
      <div class="bg-white rounded-t-xl shadow-lg border-b border-gray-200">
        <div class="flex">
          <button id="loginTab" class="flex-1 py-4 text-center font-semibold border-b-2 border-[var(--accent-teal)] text-[var(--accent-teal)]" onclick="showTab('login')">
            Login
          </button>
          <button id="signupTab" class="flex-1 py-4 text-center font-semibold border-b-2 border-transparent text-gray-500" onclick="showTab('signup')">
            Sign Up
          </button>
        </div>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="bg-white rounded-b-xl shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-6 text-gray-900">Welcome Back</h2>
        
        <form onsubmit="handleLogin(event)" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="loginEmail" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="you@example.com" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" id="loginPassword" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="••••••••" />
          </div>
          <div class="flex items-center justify-between text-sm">
            <label class="flex items-center">
              <input type="checkbox" class="mr-2" />
              <span class="text-gray-600">Remember me</span>
            </label>
            <button type="button" onclick="showResetPassword()" class="text-[var(--accent-teal)] hover:underline">Forgot password?</button>
          </div>
          <button type="submit" class="w-full bg-[var(--accent-teal)] hover:bg-teal-600 text-white font-bold py-3 rounded-lg transition">
            <i class="fas fa-sign-in-alt mr-2"></i>Login
          </button>
        </form>

        <div class="mt-6">
          <div class="relative">
            <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div>
            <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">Or continue with</span></div>
          </div>
          <button onclick="handleGoogleSignIn()" class="mt-4 w-full flex items-center justify-center gap-3 border border-gray-300 rounded-lg py-2 hover:bg-gray-50 transition">
            <i class="fab fa-google text-red-500"></i>
            <span class="font-medium text-gray-700">Sign in with Google</span>
          </button>
        </div>

        <div id="loginError" class="hidden mt-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded p-3"></div>
      </div>

      <!-- Sign Up Form -->
      <div id="signupForm" class="hidden bg-white rounded-b-xl shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-6 text-gray-900">Create Account</h2>
        
        <form onsubmit="handleSignUp(event)" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
            <input type="text" id="signupName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="John Doe" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="signupEmail" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="you@example.com" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" id="signupPassword" required minlength="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="Min. 6 characters" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
            <input type="password" id="signupConfirm" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none" placeholder="••••••••" />
          </div>
          <button type="submit" class="w-full bg-[var(--accent-teal)] hover:bg-teal-600 text-white font-bold py-3 rounded-lg transition">
            <i class="fas fa-user-plus mr-2"></i>Create Account
          </button>
        </form>

        <div class="mt-6">
          <div class="relative">
            <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div>
            <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">Or continue with</span></div>
          </div>
          <button onclick="handleGoogleSignIn()" class="mt-4 w-full flex items-center justify-center gap-3 border border-gray-300 rounded-lg py-2 hover:bg-gray-50 transition">
            <i class="fab fa-google text-red-500"></i>
            <span class="font-medium text-gray-700">Sign up with Google</span>
          </button>
        </div>

        <div id="signupError" class="hidden mt-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded p-3"></div>
      </div>

      <!-- Loading Indicator -->
      <div id="loading" class="hidden mt-4 text-center">
        <i class="fas fa-spinner fa-spin text-[var(--accent-teal)] text-2xl"></i>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white text-center text-sm py-6">
    <p>&copy; 2025 Genius Academy. All rights reserved.</p>
  </footer>

  <script type="module">
    import { signIn, signUp, signInWithGoogle, resetPassword } from './auth.js';
    import { createUserProfile, enrollInCourse } from './database.js';

    // Show/hide tabs
    window.showTab = function(tab) {
      const loginTab = document.getElementById('loginTab');
      const signupTab = document.getElementById('signupTab');
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');

      if (tab === 'login') {
        loginTab.classList.add('border-[var(--accent-teal)]', 'text-[var(--accent-teal)]');
        loginTab.classList.remove('border-transparent', 'text-gray-500');
        signupTab.classList.remove('border-[var(--accent-teal)]', 'text-[var(--accent-teal)]');
        signupTab.classList.add('border-transparent', 'text-gray-500');
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
      } else {
        signupTab.classList.add('border-[var(--accent-teal)]', 'text-[var(--accent-teal)]');
        signupTab.classList.remove('border-transparent', 'text-gray-500');
        loginTab.classList.remove('border-[var(--accent-teal)]', 'text-[var(--accent-teal)]');
        loginTab.classList.add('border-transparent', 'text-gray-500');
        signupForm.classList.remove('hidden');
        loginForm.classList.add('hidden');
      }
    }

    // Handle login
    window.handleLogin = async function(event) {
      event.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');
      const loading = document.getElementById('loading');

      loading.classList.remove('hidden');
      errorDiv.classList.add('hidden');

      const result = await signIn(email, password);
      loading.classList.add('hidden');

      if (result.success) {
        const redirectUrl = new URLSearchParams(window.location.search).get('redirect') || 'index.html';
        window.location.href = redirectUrl;
      } else {
        errorDiv.textContent = result.error;
        errorDiv.classList.remove('hidden');
      }
    }

    // Handle sign up
    window.handleSignUp = async function(event) {
      event.preventDefault();
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('signupConfirm').value;
      const errorDiv = document.getElementById('signupError');
      const loading = document.getElementById('loading');

      if (password !== confirm) {
        errorDiv.textContent = "Passwords don't match";
        errorDiv.classList.remove('hidden');
        return;
      }

      loading.classList.remove('hidden');
      errorDiv.classList.add('hidden');

      const result = await signUp(email, password, name);
      
      if (result.success) {
        // Create user profile
        await createUserProfile(result.user.uid, {
          email: email,
          displayName: name,
          enrolledCourses: []
        });

        // Auto-enroll in free flagship course
        await enrollInCourse(result.user.uid, 'prompt-engineering');

        loading.classList.add('hidden');
        const redirectUrl = new URLSearchParams(window.location.search).get('redirect') || 'index.html';
        window.location.href = redirectUrl;
      } else {
        loading.classList.add('hidden');
        errorDiv.textContent = result.error;
        errorDiv.classList.remove('hidden');
      }
    }

    // Handle Google sign in
    window.handleGoogleSignIn = async function() {
      const loading = document.getElementById('loading');
      loading.classList.remove('hidden');

      const result = await signInWithGoogle();
      
      if (result.success) {
        // Create/update profile
        await createUserProfile(result.user.uid, {
          email: result.user.email,
          displayName: result.user.displayName,
          photoURL: result.user.photoURL
        });

        // Auto-enroll in free course if new user
        await enrollInCourse(result.user.uid, 'prompt-engineering');

        loading.classList.add('hidden');
        const redirectUrl = new URLSearchParams(window.location.search).get('redirect') || 'index.html';
        window.location.href = redirectUrl;
      } else {
        loading.classList.add('hidden');
        alert(result.error);
      }
    }

    // Show password reset
    window.showResetPassword = function() {
      const email = prompt('Enter your email address:');
      if (email) {
        resetPassword(email).then(result => {
          if (result.success) {
            alert('Password reset email sent! Check your inbox.');
          } else {
            alert('Error: ' + result.error);
          }
        });
      }
    }
  </script>
</body>
</html>
